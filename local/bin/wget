#!/bin/sh
# wget wrapper which ensures the hsts file gets written to the proper XDG
# location. This could get called by other scripts, so it is intentionally
# overcautious about every variable and executable which may get used.

SCRIPT_DIR=$(CDPATH='' cd -- "$(dirname -- "$0")" && pwd)
starting_path=":$PATH:"
modified_path="$(echo "$starting_path" | sed "s|:$SCRIPT_DIR:|:|")"
real_wget="$(PATH="$modified_path" command -v wget 2>/dev/null)"
if [ -z "${real_wget}" ]; then
    shell_name="$(basename "${SHELL}")"
    prefix="$(test -n "${shell_name}" && echo "${shell_name}: ")"
    echo "${prefix}command not found: wget" >&2
    exit 1
fi
HOME="${HOME:-/home/${USER:-dan}}"
XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-${HOME}/.config}"
if [ ! -e "${XDG_CONFIG_HOME}/wget/wget-hsts.txt" ]; then
    mkdir -p "${XDG_CONFIG_HOME}/wget"
    touch "${XDG_CONFIG_HOME}/wget/wget-hsts.txt"
fi

"${real_wget}" --hsts-file="${XDG_CONFIG_HOME}/wget/wget-hsts.txt" "$@"
